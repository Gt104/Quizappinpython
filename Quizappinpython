import json
import os

FILE_NAME = "quiz_questions.json"


# Load questions from file
def load_questions():
    if os.path.exists(FILE_NAME):
        try:
            with open(FILE_NAME, "r", encoding="utf-8") as f:
                return json.load(f)
        except json.JSONDecodeError:
            print("Error: Corrupted questions file. Starting fresh.")
            return []
    return []


# Save questions to file
def save_questions(questions):
    with open(FILE_NAME, "w", encoding="utf-8") as f:
        json.dump(questions, f, indent=4, ensure_ascii=False)


# Play quiz
def play_quiz(questions):
    if not questions:
        print("\n‚ö†Ô∏è No questions available. Please add questions first.\n")
        return

    score = 0
    print("\n=== Starting Quiz ===")
    for idx, q in enumerate(questions, start=1):
        print(f"\nQ{idx}: {q['question']}")
        for i, option in enumerate(q["options"], start=1):
            print(f"  {i}. {option}")

        try:
            ans = int(input("Your answer (number): "))
            if 1 <= ans <= len(q["options"]):
                if q["options"][ans - 1].strip().lower() == q["answer"].strip().lower():
                    print("‚úÖ Correct!")
                    score += 1
                else:
                    print(f"‚ùå Wrong! Correct answer: {q['answer']}")
            else:
                print(f"‚ö†Ô∏è Please choose a valid option. Correct answer: {q['answer']}")
        except ValueError:
            print(f"‚ö†Ô∏è Invalid input! Correct answer: {q['answer']}")

    print(f"\nüéØ Quiz finished! Your score: {score}/{len(questions)}\n")


# Add new question
def add_question(questions):
    print("\n=== Add a New Question ===")
    question = input("Enter question: ").strip()

    options = []
    while len(options) < 4:
        opt = input(f"Option {len(options) + 1}: ").strip()
        if opt:
            options.append(opt)
        else:
            print("‚ö†Ô∏è Option cannot be empty!")

    answer = input("Enter correct answer (must match one of the options): ").strip()

    if answer not in options:
        print("‚ö†Ô∏è Error: Answer must be one of the options!")
        return

    questions.append({"question": question, "options": options, "answer": answer})
    save_questions(questions)
    print("‚úÖ Question added successfully!\n")


# Main menu
def main():
    questions = load_questions()
    while True:
        print("=== QUIZ APP ===")
        print("1. Play Quiz")
        print("2. Add Question")
        print("3. Exit")

        choice = input("Choose option: ").strip()
        if choice == "1":
            play_quiz(questions)
        elif choice == "2":
            add_question(questions)
        elif choice == "3":
            print("üëã Goodbye!")
            break
        else:
            print("‚ö†Ô∏è Invalid option. Please try again.\n")


if __name__ == "__main__":
    main()
